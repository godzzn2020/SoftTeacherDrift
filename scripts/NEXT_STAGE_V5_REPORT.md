# NEXT_STAGE V5 Report (Latency Optimization + Gating Rule)

- 生成时间：2026-01-08 01:40:28
- 环境要求（命令）：`source ~/anaconda3/etc/profile.d/conda.sh && conda activate ZZNSTD`
- Python：`/home/ylh/anaconda3/envs/ZZNSTD/bin/python` / `3.10.19`

## 关键口径（Latency → tol500）
- 时间轴：统一使用 `sample_idx`；tol500 口径匹配条件为 `confirmed_step <= drift_pos + 500`。
- 经验现象：`MDR_win≈0` 但 `miss_tol500/MDR_tol500` 高通常不是完全漏检，而是 **P90/P99 延迟 > 500 的晚检**。

## Track M：Latency 优化（sea_abrupt4）
| config_tag | trigger | theta | window | acc_final | acc_min | MDR_win | MTFA_win | MTR_win | miss_tol500 | MDR_tol500 | cand_P90 | conf_P90 | err_thr | err_min | div_thr | div_min |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| or_default | or | 0.50 | 1 | 0.8707±0.0015 | 0.5266±0.0969 | 0.000 | 1796.5 | 2.309 | 0.650 | 0.650 | 1199.0 | 1199.0 | 0.200 | 25 | 0.050 | 30 |
| two_stage_err(mi=10,thr=0.1) | two_stage | 0.30 | 1 | 0.8698±0.0101 | 0.4276±0.1931 | 0.000 | 664.3 | 2.154 | 0.100 | 0.100 | 482.2 | 482.2 | 0.100 | 10 | 0.050 | 30 |
| two_stage_err(mi=5,thr=0.2) | two_stage | 0.30 | 1 | 0.8766±0.0134 | 0.5054±0.1822 | 0.000 | 575.7 | 2.308 | 0.150 | 0.150 | 687.0 | 687.0 | 0.200 | 5 | 0.050 | 30 |
| two_stage_err(mi=10,thr=0.2) | two_stage | 0.30 | 1 | 0.8773±0.0073 | 0.5106±0.1595 | 0.000 | 828.4 | 2.289 | 0.300 | 0.300 | 688.6 | 688.6 | 0.200 | 10 | 0.050 | 30 |
| two_stage_div(mi=10,thr=0.02) | two_stage | 0.30 | 1 | 0.8690±0.0064 | 0.4344±0.1717 | 0.000 | 1218.7 | 2.515 | 0.350 | 0.350 | 1199.0 | 1199.0 | 0.200 | 25 | 0.020 | 10 |
| two_stage_div(mi=30,thr=0.02) | two_stage | 0.30 | 1 | 0.8720±0.0068 | 0.6577±0.1108 | 0.000 | 1271.0 | 2.332 | 0.450 | 0.450 | 1013.4 | 1013.4 | 0.200 | 25 | 0.020 | 30 |
| two_stage_div(mi=5,thr=0.02) | two_stage | 0.30 | 1 | 0.8746±0.0094 | 0.5406±0.1900 | 0.000 | 1185.8 | 2.086 | 0.450 | 0.450 | 1199.0 | 1199.0 | 0.200 | 25 | 0.020 | 5 |
| two_stage_default | two_stage | 0.30 | 1 | 0.8694±0.0098 | 0.4813±0.1068 | 0.000 | 1826.8 | 2.388 | 0.600 | 0.600 | 1213.4 | 1213.4 | 0.200 | 25 | 0.050 | 30 |
| two_stage_div(mi=5,thr=0.05) | two_stage | 0.30 | 1 | 0.8674±0.0128 | 0.4797±0.1910 | 0.000 | 1796.4 | 2.615 | 0.600 | 0.600 | 1199.0 | 1199.0 | 0.200 | 25 | 0.050 | 5 |
| two_stage_div(mi=10,thr=0.05) | two_stage | 0.30 | 1 | 0.8657±0.0065 | 0.3781±0.0753 | 0.000 | 1825.3 | 2.572 | 0.700 | 0.700 | 1199.0 | 1199.0 | 0.200 | 25 | 0.050 | 10 |
| two_stage_div(mi=10,thr=0.08) | two_stage | 0.30 | 1 | 0.8689±0.0102 | 0.4562±0.1791 | 0.000 | 1913.5 | 2.542 | 0.700 | 0.700 | 1199.0 | 1199.0 | 0.200 | 25 | 0.080 | 10 |
| two_stage_err(mi=25,thr=0.05) | two_stage | 0.30 | 1 | 0.8737±0.0049 | 0.5583±0.1140 | 0.000 | 1766.1 | 1.907 | 0.700 | 0.700 | 1599.0 | 1599.0 | 0.050 | 25 | 0.050 | 30 |
| two_stage_div(mi=30,thr=0.08) | two_stage | 0.30 | 1 | 0.8659±0.0109 | 0.4702±0.1638 | 0.000 | 1880.3 | 2.626 | 0.750 | 0.750 | 1199.0 | 1199.0 | 0.200 | 25 | 0.080 | 30 |
| two_stage_div(mi=5,thr=0.08) | two_stage | 0.30 | 1 | 0.8678±0.0037 | 0.4766±0.1914 | 0.000 | 1872.8 | 2.267 | 0.750 | 0.750 | 1285.4 | 1285.4 | 0.200 | 25 | 0.080 | 5 |
| two_stage_err(mi=25,thr=0.1) | two_stage | 0.30 | 1 | 0.8708±0.0073 | 0.5312±0.1321 | 0.000 | 1805.1 | 1.807 | 0.750 | 0.750 | 1599.0 | 1599.0 | 0.100 | 25 | 0.050 | 30 |
| two_stage_err(mi=10,thr=0.05) | two_stage | 0.30 | 1 | 0.8752±0.0048 | 0.5172±0.1705 | 0.000 | 664.3 | 2.381 | 0.000 | 0.000 | 479.0 | 479.0 | 0.050 | 10 | 0.050 | 30 |
| two_stage_err(mi=5,thr=0.05) | two_stage | 0.30 | 1 | 0.8743±0.0107 | 0.4621±0.1878 | 0.000 | 338.1 | 2.197 | 0.000 | 0.000 | 287.0 | 287.0 | 0.050 | 5 | 0.050 | 30 |
| two_stage_err(mi=5,thr=0.1) | two_stage | 0.30 | 1 | 0.8722±0.0062 | 0.4198±0.1616 | 0.000 | 345.3 | 2.419 | 0.000 | 0.000 | 303.0 | 303.0 | 0.100 | 5 | 0.050 | 30 |

**选择规则（写入论文/报告）**
- 规则：acc_final_mean≥best-0.01，先最小化 miss_tol500_mean，再最小化 conf_P90，再最大化 acc_min_mean（再看 MTFA/MTR）；best_acc=0.8773
**推荐 PH 参数（sea_abrupt4）**
- config_tag=`two_stage_err(mi=5,thr=0.05)`, monitor_preset=`error_divergence_ph_meta@error.threshold=0.05,error.min_instances=5`, theta=0.30, window=1
- 效果摘要：miss_tol500=0.000, conf_P90=287.0, acc_final=0.8743, acc_min=0.4621

## Track N：Gating 规则化（INSECTS_abrupt_balanced）
| group | m | n_runs | acc_final | acc_min | post_mean@W1000 | post_min@W1000 | recovery_time_to_pre90 |
|---|---|---|---|---|---|---|---|
| v2 | 1 | 10 | 0.1999±0.0116 | 0.1571±0.0215 | 0.1895±0.0102 | 0.1886±0.0102 | 178.4±0.0 |
| v2_gate_m1 | 1 | 10 | 0.2008±0.0074 | 0.1503±0.0313 | 0.1920±0.0069 | 0.1912±0.0070 | 178.4±0.0 |
| v2_gate_m3 | 3 | 10 | 0.2016±0.0087 | 0.1318±0.0421 | 0.1905±0.0090 | 0.1897±0.0090 | 178.4±0.0 |
| v2_gate_m5 | 5 | 10 | 0.1988±0.0078 | 0.1571±0.0144 | 0.1893±0.0069 | 0.1885±0.0068 | 178.4±0.0 |

**选择规则（可复现）**
- 规则：acc_final_mean≥best-0.01，优先最大化 post_min@W1000，再最大化 acc_min；best_acc=0.2016
**推荐 gating 强度**
- group=`v2_gate_m1`, m=1（post_min@W1000 最大且 acc_final 不降超过阈值）

## 最终默认配置（论文可写）
- 触发：two_stage（candidate=OR，confirm=weighted），并使用 Track M 的 tuned PageHinkley（`monitor_preset` 记录完整覆盖参数）。
- 严重度：severity v2 + confirmed drift gating（推荐 `v2_gate_m1`），用于缓解负迁移并提升 post_min@W1000 / acc_min。

